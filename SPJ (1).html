<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistem Penggandaan - Kecamatan Pontianak Timur</title>
  <style>
    /* Gaya Utama */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f8f9fa;
      color: #333;
      line-height: 1.6;
      font-size: 14px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    h1, h2, h3 {
      color: #003366;
      margin-top: 0;
    }
    
    h1 {
      font-size: 24px;
      padding-bottom: 10px;
      border-bottom: 2px solid #003366;
    }
    
    /* Tab Navigation */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      background: #f1f1f1;
      border-radius: 5px;
      overflow: hidden;
    }
    
    .tab {
      padding: 12px 20px;
      background: #e0e0e0;
      cursor: pointer;
      border: none;
      flex: 1;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    
    .tab:hover {
      background: #d0d0d0;
    }
    
    .tab.active {
      background: #003366;
      color: white;
    }
    
    /* Tab Content */
    .tab-content {
      display: none;
      padding: 20px;
      background: white;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Form Styles */
    .form-section {
      margin-bottom: 25px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 5px;
      border: 1px solid #eee;
    }
    
    .form-group {
      margin-bottom: 10px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      font-size: 13px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
      font-size: 12px;
      box-sizing: border-box;
    }
    
    textarea {
      min-height: 50px;
      resize: vertical;
    }
    
    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      table-layout: fixed;
      font-size: 12px;
    }
    
    th {
      background-color: #003366;
      color: white;
      padding: 10px;
      text-align: left;
    }
    
    td {
      padding: 8px;
      border: 1px solid #ddd;
      vertical-align: top;
    }
    
    .number {
      text-align: right;
    }
    
    .text-center {
      text-align: center;
    }
    
    /* Button Styles */
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .btn-primary {
      background-color: #003366;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #002244;
    }
    
    .btn-success {
      background-color: #28a745;
      color: white;
    }
    
    .btn-success:hover {
      background-color: #218838;
    }
    
    .btn-danger {
      background-color: #dc3545;
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #c82333;
    }
    
    .btn-info {
      background-color: #17a2b8;
      color: white;
    }
    
    .btn-info:hover {
      background-color: #138496;
    }
    
    /* Signature Styles */
    .signature-container {
      display: flex;
      justify-content: space-between;
      margin-top: 50px;
    }
    
    .signature-box {
      text-align: center;
      flex: 1;
    }
    
    .signature-box p {
      margin: 2px 0;
    }
    
    .signature-space {
      height: 80px;
      margin: 20px 0;
    }
    
    /* Print Styles */
    @media print {
      body {
        background: white;
        font-size: 12pt;
      }
      
      .no-print {
        display: none !important;
      }
      
      .tab-content {
        display: block !important;
        border: none;
        box-shadow: none;
        padding: 0;
      }
      
      table {
        page-break-inside: auto;
      }
      
      tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }
      
      .container {
        padding: 0;
        max-width: 100%;
      }
    }
    
    /* Utility Classes */
    .bold {
      font-weight: bold;
    }
    
    .italic {
      font-style: italic;
    }
    
    .underline {
      text-decoration: underline;
    }
    
    .mt-10 {
      margin-top: 10px;
    }
    
    .mt-20 {
      margin-top: 20px;
    }
    
    .mb-10 {
      margin-bottom: 10px;
    }
    
    .mb-20 {
      margin-bottom: 20px;
    }
    
    /* Alert Styles */
    .alert {
      padding: 10px 15px;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    
    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .tabs {
        flex-direction: column;
      }
      
      .tab {
        padding: 10px;
      }
      
      .signature-container {
        flex-direction: column;
      }
      
      .signature-box {
        margin-bottom: 30px;
      }
    }
  </style>

  <!-- Firebase SDK (Modular Format) -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

    // Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBouCJvyHHKhECFLMnwNYlLLuRnuwGV0Vw",
      authDomain: "spj-kec-timur.firebaseapp.com",
      projectId: "spj-kec-timur",
      storageBucket: "spj-kec-timur.appspot.com",
      messagingSenderId: "253452787552",
      appId: "1:253452787552:web:779159948071304b9dc805",
      measurementId: "G-6JND8QSH9W"
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // Tambahkan fungsi ke window agar bisa diakses dari script utama
    window.firebaseService = {
      async saveData(data) {
        try {
          const docRef = await addDoc(collection(db, "surat_pesanan"), {
            ...data,
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp()
          });
          return docRef.id;
        } catch (e) {
          console.error("Error menyimpan data ke Firebase: ", e);
          throw e;
        }
      }
    };
  </script>
</head>
<body>
  <div class="container">
    <h1>Sistem Penggandaan - Kecamatan Pontianak Timur</h1>
    
    <!-- Alert Area -->
    <div id="alertArea"></div>

    <!-- Tab Navigation -->
    <div class="tabs">
      <div class="tab active" data-tab="input" onclick="openTab('input')">Mohon Isi di Sini</div>
      <div class="tab" data-tab="sp" onclick="openTab('sp')">Surat Pesanan (SP)</div>
      <div class="tab" data-tab="st" onclick="openTab('st')">Bukti Penerimaan (ST)</div>
      <div class="tab" data-tab="kwitansi" onclick="openTab('kwitansi')">Kwitansi</div>
    </div>

    <!-- Tab Input Data -->
    <div id="input" class="tab-content active">
      <h2>Formulir Input Data</h2>

      <!-- Bagian 1: Informasi Umum -->
      <div class="form-section">
        <h3>Informasi Umum</h3>
        
        <div class="form-group">
          <label for="tahun">Tahun Anggaran</label>
          <input type="number" id="tahun" placeholder="Contoh: 2025" required>
        </div>
        
        <div class="form-group">
          <label for="unit">Unit</label>
          <input type="text" id="unit" placeholder="Contoh: Kecamatan Pontianak Timur" required>
        </div>
        
        <div class="form-group">
          <label for="pa">PA (Pengguna Anggaran)</label>
          <input type="text" id="pa" placeholder="Gunakan HURUF KAPITAL" required>
        </div>
        
        <div class="form-group">
          <label for="nip_pa">NIP PA</label>
          <input type="text" id="nip_pa" placeholder="Contoh: 19720103 200701 1 028" required>
        </div>
        
        <div class="form-group">
          <label for="jabatan_pa">Jabatan PA</label>
          <input type="text" id="jabatan_pa" placeholder="Contoh: Pengguna Anggaran" required>
        </div>
        
        <div class="form-group">
          <label for="pptk">PPTK</label>
          <input type="text" id="pptk" placeholder="Gunakan HURUF KAPITAL" required>
        </div>
        
        <div class="form-group">
          <label for="nip_pptk">NIP PPTK</label>
          <input type="text" id="nip_pptk" placeholder="Contoh: 19840714 201001 1 002" required>
        </div>
        
        <div class="form-group">
          <label for="jabatan_pptk">Jabatan PPTK</label>
          <input type="text" id="jabatan_pptk" placeholder="Contoh: Pejabat Pelaksana Teknis Kegiatan" required>
        </div>
        
        <div class="form-group">
          <label for="penyimpan">Penyimpan Barang</label>
          <input type="text" id="penyimpan" placeholder="Gunakan HURUF KAPITAL" required>
        </div>
        
        <div class="form-group">
          <label for="nip_penyimpan">NIP Penyimpan</label>
          <input type="text" id="nip_penyimpan" placeholder="Contoh: 19790304 200501 1 007" required>
        </div>
        
        <div class="form-group">
          <label for="jabatan_penyimpan">Jabatan Penyimpan</label>
          <input type="text" id="jabatan_penyimpan" placeholder="Contoh: Penyimpan Barang" required>
        </div>
        
        <div class="form-group">
          <label for="bp">Nama BP (Bendahara Pengeluaran)</label>
          <input type="text" id="bp" placeholder="Gunakan HURUF KAPITAL" required>
        </div>
        
        <div class="form-group">
          <label for="nip_bp">NIP BP</label>
          <input type="text" id="nip_bp" placeholder="Contoh: 19880121 201001 2 003" required>
        </div>
        
        <div class="form-group">
          <label for="jabatan_bp">Jabatan BP</label>
          <input type="text" id="jabatan_bp" placeholder="Contoh: Bendahara Pengeluaran" required>
        </div>
        
        <div class="form-group">
          <label for="alamat_kel">Alamat Kelurahan</label>
          <input type="text" id="alamat_kel" placeholder="Contoh: Jalan H. Rasuna Said Perumnas 3 Kelurahan Tanjung Hulu" required>
        </div>
        
        <div class="form-group">
          <label for="bidang">Bidang</label>
          <input type="text" id="bidang" placeholder="Contoh: Sekretariat/Kec.Timur" required>
        </div>
        
        <div class="form-group">
          <label for="sub_keg">Sub Kegiatan</label>
          <input type="text" id="sub_keg" placeholder="Contoh: Penyediaan Barang Cetakan dan Penggandaan" required>
        </div>
        
        <div class="form-group">
          <label for="kode_rek">Kode Rekening</label>
          <input type="text" id="kode_rek" placeholder="Contoh: 7.01.01.2.06.0005" required>
        </div>
        
        <div class="form-group">
          <label for="ro">Rincian Objek (RO)</label>
          <input type="text" id="ro" placeholder="Contoh: 5.1.02.01.01.0024" required>
        </div>
        
        <div class="form-group">
          <label for="belanja">Belanja</label>
          <input type="text" id="belanja" placeholder="Contoh: Belanja Alat/Bahan untuk Kegiatan Kantor-Alat Tulis Kantor" required>
        </div>
      </div>

      <!-- Bagian 2: Informasi Penyedia -->
      <div class="form-section">
        <h3>Informasi Penyedia Barang/Jasa</h3>
        
        <div class="form-group">
          <label for="no_sp">Nomor Pesanan</label>
          <input type="text" id="no_sp" placeholder="Contoh: 020 / 9.4 / SP / Sekcam / II / 2025" required>
        </div>
        
        <div class="form-group">
          <label for="tgl_sp">Tanggal Pesanan</label>
          <input type="text" id="tgl_sp" placeholder="Contoh: 12 Februari 2025" required>
        </div>
        
        <div class="form-group">
          <label for="no_bast">Nomor BAST</label>
          <input type="text" id="no_bast" placeholder="Contoh: 9.4 / BA.STB / Sekcam / II / 2025" required>
        </div>
        
        <div class="form-group">
          <label for="tgl_bast">Tanggal BAST</label>
          <input type="text" id="tgl_bast" placeholder="Contoh: 14 Februari 2025" required>
        </div>
        
        <div class="form-group">
          <label for="perusahaan">Perusahaan</label>
          <input type="text" id="perusahaan" placeholder="Gunakan HURUF KAPITAL" required>
        </div>
        
        <div class="form-group">
          <label for="pimpinan">Pimpinan</label>
          <input type="text" id="pimpinan" placeholder="Gunakan HURUF KAPITAL" required>
        </div>
        
        <div class="form-group">
          <label for="alamat">Alamat</label>
          <input type="text" id="alamat" placeholder="Contoh: Jl. Panglima Aim No.155 D Kel. Tanjung Hulu Pontianak" required>
        </div>
        
        <div class="form-group">
          <label for="rekening">Nomor Rekening</label>
          <input type="text" id="rekening" placeholder="Contoh: 1725043101" required>
        </div>
        
        <div class="form-group">
          <label for="bank">Bank</label>
          <input type="text" id="bank" placeholder="Contoh: Bank Kalbar / a.n Juonvi Novia, ST" required>
        </div>
        
        <div class="form-group">
          <label for="npwp">NPWP/NPWPD</label>
          <input type="text" id="npwp" placeholder="Contoh: 35.559.320.3-701.000" required>
        </div>
        
        <div class="form-group">
          <label for="no_kwitansi">Nomor Kwitansi</label>
          <input type="text" id="no_kwitansi" placeholder="Contoh: / GU / 2025" required>
        </div>
        
        <div class="form-group">
          <label for="tgl_kwitansi">Tanggal Kwitansi</label>
          <input type="text" id="tgl_kwitansi" placeholder="Contoh: Pontianak, 14 Februari 2025" required>
        </div>
      </div>

      <!-- Bagian 3: Tabel Barang -->
      <h3>Daftar Barang</h3>
      <table id="inputTable">
        <thead>
          <tr>
            <th width="5%">No</th>
            <th width="20%">Jenis Barang</th>
            <th width="30%">Keterangan</th>
            <th width="10%">Volume</th>
            <th width="10%">Satuan</th>
            <th width="15%">Harga Satuan (Rp)</th>
            <th width="15%">Jumlah Harga (Rp)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="number">1</td>
            <td>
              <select onchange="updateRow(this)" class="jenis-barang">
                <option value="Foto Copy">Foto Copy</option>
                <option value="ATK">ATK</option>
                <option value="Lainnya">Lainnya</option>
              </select>
            </td>
            <td>
              <textarea placeholder="Masukkan keterangan..." oninput="updateRow(this)" rows="2" class="keterangan"></textarea>
            </td>
            <td>
              <input type="number" class="volume" oninput="calculateRow(this)" min="0" step="0.01" value="0">
            </td>
            <td>
              <select class="satuan" onchange="updateRow(this)">
                <option value="Lembar">Lembar</option>
                <option value="Buku">Buku</option>
                <option value="Rim">Rim</option>
                <option value="Pcs">Pcs</option>
                <option value="Unit">Unit</option>
              </select>
            </td>
            <td>
              <input type="number" class="harga" oninput="calculateRow(this)" min="0" step="100" value="0">
            </td>
            <td class="jumlah number bold">0</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="6" style="text-align: right;"><strong>Total Nilai:</strong></td>
            <td class="jumlah-total number bold">0</td>
          </tr>
          <tr>
            <td colspan="7" class="italic">
              <strong>Terbilang:</strong> <span id="terbilang">Nol Rupiah</span>
            </td>
          </tr>
        </tfoot>
      </table>

      <div class="mt-20">
        <button onclick="addRow()" class="btn btn-success">+ Tambah Baris</button>
        <button onclick="removeRow()" class="btn btn-danger">- Hapus Baris</button>
      </div>

      <!-- Tombol Aksi -->
      <div class="mt-20">
        <button onclick="saveToFirebase()" class="btn btn-primary">💾 Simpan ke Database</button>
        <button onclick="saveToLocalStorage()" class="btn btn-info">💾 Simpan Sementara</button>
        <button onclick="loadFromLocalStorage()" class="btn btn-info">↻ Muat Data</button>
        <button onclick="resetForm()" class="btn btn-danger">🗑️ Reset Form</button>
      </div>
    </div>

    <!-- Tab Surat Pesanan (SP) -->
    <div id="sp" class="tab-content">
      <div class="no-print">
        <button onclick="printSP()" class="btn btn-success">🖨️ Cetak Surat Pesanan</button>
        <button onclick="exportToPDF('printAreaSP', 'Surat_Pesanan')" class="btn btn-primary">📄 Export PDF</button>
      </div>

      <div id="printAreaSP">
        <!-- Kop Surat -->
        <table style="width: 100%; border: none; margin-bottom: 10px;">
          <tr>
            <td style="width: 15%; vertical-align: top;">
              <img src="logo_pontianak.png" alt="Logo Kota Pontianak" style="width: 100px; height: auto;" />
            </td>
            <td style="width: 85%; text-align: center; padding-left: 20px;">
              <p style="font-size: 20px; font-weight: bold; margin: 0;">PEMERINTAH KOTA PONTIANAK</p>
              <p style="font-size: 20px; font-weight: bold; margin: 0;">KECAMATAN PONTIANAK TIMUR</p>
              <p style="margin: 5px 0;">Jalan H. Rasuna Said Komplek Perumnas III Tanjung Hulu Telp. (0561) 742305 Pontianak 78237</p>
              <p style="margin: 5px 0;">Website : camattimur.pontianakkota.go.id | Email : kecpontianaktimur@gmail.com</p>
            </td>
          </tr>
        </table>

        <hr style="border: 1px solid #000; margin: 10px 0;" />

        <!-- Tahun Anggaran dan Kode Rekening -->
        <div style="text-align: right; margin-bottom: 15px; font-weight: bold;">
          <div>Tahun Anggaran <span id="sp_tahun">2025</span></div>
          <div>Kode Rekening</div>
          <div style="font-size: 16px; margin-top: 4px;"><span id="sp_kode_rek"></span></div>
        </div>

        <!-- Judul Surat Pesanan -->
        <h2 style="text-align: center; text-decoration: none; color: black;">SURAT PESANAN</h2>

        <p><strong>Nomor:</strong> <span id="sp_no"></span></p>
        <p><strong>Kepada:</strong> <span id="sp_perusahaan"></span></p>
        <p><strong>Alamat:</strong> <span id="sp_alamat"></span></p>
        <p><strong>No Rekening:</strong> <span id="sp_rekening"></span> | <strong>Bank:</strong> <span id="sp_bank"></span></p>
        <p><strong>NPWP:</strong> <span id="sp_npwp"></span></p>

        <table id="spTable">
          <thead>
            <tr>
              <th width="5%">No</th>
              <th width="20%">Jenis Barang</th>
              <th width="30%">Keterangan</th>
              <th width="10%">Volume</th>
              <th width="10%">Satuan</th>
              <th width="15%">Harga Satuan (Rp)</th>
              <th width="15%">Jumlah Harga (Rp)</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td colspan="6" style="text-align: right;"><strong>Total Nilai:</strong></td>
              <td class="jumlah-total number bold">0</td>
            </tr>
            <tr>
              <td colspan="7" class="italic">
                <strong>Terbilang:</strong> <span id="spTerbilang">Nol Rupiah</span>
              </td>
            </tr>
          </tfoot>
        </table>

        <!-- Keterangan -->
        <p><strong>Keterangan:</strong></p>
        <p>1. Harga Sudah Termasuk Pajak</p>

        <p>Demikian surat ini disampaikan, atas kerjasamanya diucapkan terima kasih.</p>

        <!-- Tanggal -->
        <p style="text-align: right;">Pontianak, <span id="sp_tanggal"></span></p>

        <!-- Penandatanganan -->
        <div class="signature-container">
          <div class="signature-box">
            <p><strong>Mengetahui,</strong></p>
            <p><strong>Kuasa Pengguna Anggaran</strong></p>
            <p><strong>Kecamatan Pontianak Timur</strong></p>
            <div class="signature-space"></div>
            <p><strong><u><span id="pa_name">M. AKIF, SH.</span></u></strong></p>
            <p><strong>NIP. <span id="pa_nip">19720103 200701 1 028</span></strong></p>
          </div>
          <div class="signature-box">
            <p>&nbsp;</p>
            <p><strong>Pejabat Pelaksana Teknis Kegiatan</strong></p>
            <p><strong>Kecamatan Pontianak Timur</strong></p>
            <div class="signature-space"></div>
            <p><strong><u><span id="pptk_name">JULIUS, SH</span></u></strong></p>
            <p><strong>NIP. <span id="pptk_nip">19840714 201001 1 002</span></strong></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Bukti Penerimaan (ST) -->
    <div id="st" class="tab-content">
      <div class="no-print">
        <button onclick="printST()" class="btn btn-success">🖨️ Cetak Bukti Penerimaan</button>
        <button onclick="exportToPDF('printAreaST', 'Bukti_Penerimaan')" class="btn btn-primary">📄 Export PDF</button>
      </div>

      <div id="printAreaST">
        <h2 style="text-align: center;">BUKTI PENERIMAAN BARANG (ST)</h2>
        
        <table style="width: 100%; border: none; margin-bottom: 15px;">
          <tr>
            <td style="width: 20%;"><strong>Nomor:</strong></td>
            <td style="width: 80%;"><span id="st_no"></span></td>
          </tr>
          <tr>
            <td><strong>Tanggal:</strong></td>
            <td><span id="st_tanggal"></span></td>
          </tr>
          <tr>
            <td><strong>Penyedia:</strong></td>
            <td><span id="st_perusahaan"></span></td>
          </tr>
        </table>

        <p><strong>Daftar Barang:</strong></p>

        <table id="stTable">
          <thead>
            <tr>
              <th width="5%">No</th>
              <th width="20%">Jenis Barang</th>
              <th width="30%">Keterangan</th>
              <th width="10%">Volume</th>
              <th width="10%">Satuan</th>
              <th width="15%">Harga Satuan (Rp)</th>
              <th width="15%">Jumlah Harga (Rp)</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td colspan="6" style="text-align: right;"><strong>Total Nilai:</strong></td>
              <td class="jumlah-total number bold">0</td>
            </tr>
            <tr>
              <td colspan="7" class="italic">
                <strong>Terbilang:</strong> <span id="stTerbilang">Nol Rupiah</span>
              </td>
            </tr>
          </tfoot>
        </table>

        <div class="signature-container mt-20">
          <div class="signature-box">
            <p><strong>Penerima,</strong></p>
            <div class="signature-space"></div>
            <p><strong><u><span id="st_penyimpan"></span></u></strong></p>
            <p><strong>NIP. <span id="st_nip_penyimpan"></span></strong></p>
          </div>
          <div class="signature-box">
            <p><strong>Mengetahui,</strong></p>
            <p><strong>PPTK</strong></p>
            <div class="signature-space"></div>
            <p><strong><u><span id="st_pptk"></span></u></strong></p>
            <p><strong>NIP. <span id="st_nip_pptk"></span></strong></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Kwitansi -->
    <div id="kwitansi" class="tab-content">
      <div class="no-print">
        <button onclick="printKwitansi()" class="btn btn-success">🖨️ Cetak Kwitansi</button>
        <button onclick="exportToPDF('printAreaKwitansi', 'Kwitansi')" class="btn btn-primary">📄 Export PDF</button>
      </div>

      <div id="printAreaKwitansi">
        <h2 style="text-align: center;">KWITANSI</h2>
        
        <table style="width: 100%; border: none; margin-bottom: 15px;">
          <tr>
            <td style="width: 30%;"><strong>Nomor:</strong></td>
            <td style="width: 70%;"><span id="kw_no"></span></td>
          </tr>
          <tr>
            <td><strong>Sudah Terima Dari:</strong></td>
            <td>Pengguna Anggaran Kecamatan Pontianak Timur</td>
          </tr>
          <tr>
            <td><strong>Uang Sebesar:</strong></td>
            <td><span id="kwitansiTerbilang">Nol Rupiah</span></td>
          </tr>
          <tr>
            <td><strong>Untuk Pembayaran:</strong></td>
            <td><span id="kwitansi_belanja"></span> pada Sub Kegiatan <span id="kwitansi_sub_keg"></span> Tahun Anggaran <span id="kwitansi_tahun"></span></td>
          </tr>
        </table>

        <p><strong>Berdasarkan:</strong></p>
        <ul>
          <li>Surat Pesanan: <span id="kw_sp"></span> tanggal <span id="kw_sp_tgl"></span></li>
          <li>BAST: <span id="kw_bast"></span> tanggal <span id="kw_bast_tgl"></span></li>
        </ul>

        <table id="kwitansiTable">
          <thead>
            <tr>
              <th width="5%">No</th>
              <th width="20%">Jenis Barang</th>
              <th width="30%">Keterangan</th>
              <th width="10%">Volume</th>
              <th width="10%">Satuan</th>
              <th width="15%">Harga Satuan (Rp)</th>
              <th width="15%">Jumlah Harga (Rp)</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td colspan="6" style="text-align: right;"><strong>Jumlah:</strong></td>
              <td class="jumlah-total number bold">0</td>
            </tr>
          </tfoot>
        </table>

        <div class="signature-container mt-20">
          <div class="signature-box">
            <p>Penerima,</p>
            <div class="signature-space"></div>
            <p><strong><u><span id="kw_pimpinan"></span></u></strong></p>
            <p>Direktur/Pimpinan</p>
            <p><span id="kw_perusahaan"></span></p>
          </div>
          <div class="signature-box">
            <p>Mengetahui,</p>
            <p>Bendahara Pengeluaran</p>
            <div class="signature-space"></div>
            <p><strong><u><span id="kw_bp"></span></u></strong></p>
            <p>NIP. <span id="kw_nip_bp"></span></p>
          </div>
        </div>

        <p style="text-align: right;">Pontianak, <span id="kw_tanggal"></span></p>
      </div>
    </div>

    <div class="footer mt-20">
      <p>Sistem ini dibuat untuk memudahkan pengisian dokumen keuangan Kecamatan Pontianak Timur.</p>
      <p>Versi 2.0 | © 2024 Kecamatan Pontianak Timur</p>
    </div>
  </div>

  <!-- Script Utama -->
  <script>
    // Data state untuk menyimpan semua input
    const appState = {
      generalInfo: {},
      providerInfo: {},
      items: []
    };

    // Fungsi Buka Tab
    function openTab(tabName) {
      const tabs = document.querySelectorAll(".tab");
      const contents = document.querySelectorAll(".tab-content");
      
      tabs.forEach(tab => tab.classList.remove("active"));
      contents.forEach(content => content.classList.remove("active"));
      
      document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add("active");
      document.getElementById(tabName).classList.add("active");
      
      // Simpan data ke state saat berpindah tab
      if (tabName === 'input') {
        saveInputData();
      }
      
      // Perbarui tampilan tab tujuan
      updateOutputTabs();
    }

    // Fungsi untuk menyimpan data input ke state
    function saveInputData() {
      // Simpan informasi umum
      appState.generalInfo = {
        tahun: document.getElementById("tahun").value,
        unit: document.getElementById("unit").value,
        pa: document.getElementById("pa").value,
        nip_pa: document.getElementById("nip_pa").value,
        jabatan_pa: document.getElementById("jabatan_pa").value,
        pptk: document.getElementById("pptk").value,
        nip_pptk: document.getElementById("nip_pptk").value,
        jabatan_pptk: document.getElementById("jabatan_pptk").value,
        penyimpan: document.getElementById("penyimpan").value,
        nip_penyimpan: document.getElementById("nip_penyimpan").value,
        jabatan_penyimpan: document.getElementById("jabatan_penyimpan").value,
        bp: document.getElementById("bp").value,
        nip_bp: document.getElementById("nip_bp").value,
        jabatan_bp: document.getElementById("jabatan_bp").value,
        alamat_kel: document.getElementById("alamat_kel").value,
        bidang: document.getElementById("bidang").value,
        sub_keg: document.getElementById("sub_keg").value,
        kode_rek: document.getElementById("kode_rek").value,
        ro: document.getElementById("ro").value,
        belanja: document.getElementById("belanja").value
      };

      // Simpan informasi penyedia
      appState.providerInfo = {
        no_sp: document.getElementById("no_sp").value,
        tgl_sp: document.getElementById("tgl_sp").value,
        no_bast: document.getElementById("no_bast").value,
        tgl_bast: document.getElementById("tgl_bast").value,
        perusahaan: document.getElementById("perusahaan").value,
        pimpinan: document.getElementById("pimpinan").value,
        alamat: document.getElementById("alamat").value,
        rekening: document.getElementById("rekening").value,
        bank: document.getElementById("bank").value,
        npwp: document.getElementById("npwp").value,
        no_kwitansi: document.getElementById("no_kwitansi").value,
        tgl_kwitansi: document.getElementById("tgl_kwitansi").value
      };

      // Simpan item barang
      appState.items = [];
      const rows = document.querySelectorAll("#inputTable tbody tr");
      
      rows.forEach((row, index) => {
        appState.items.push({
          no: index + 1,
          jenis: row.querySelector(".jenis-barang").value,
          keterangan: row.querySelector(".keterangan").value || "-",
          volume: parseFloat(row.querySelector(".volume").value) || 0,
          satuan: row.querySelector(".satuan").value,
          harga: parseFloat(row.querySelector(".harga").value) || 0,
          jumlah: (parseFloat(row.querySelector(".volume").value) || 0) * (parseFloat(row.querySelector(".harga").value) || 0)
        });
      });
    }

    // Fungsi untuk memperbarui semua tab output
    function updateOutputTabs() {
      // Hitung total
      const total = appState.items.reduce((sum, item) => sum + item.jumlah, 0);
      const terbilangText = terbilang(total) + " Rupiah";

      // Update Surat Pesanan (SP)
      updateTable("spTable", appState.items);
      document.getElementById("spTerbilang").textContent = terbilangText;
      document.getElementById("sp_no").textContent = appState.providerInfo.no_sp;
      document.getElementById("sp_perusahaan").textContent = appState.providerInfo.perusahaan;
      document.getElementById("sp_alamat").textContent = appState.providerInfo.alamat;
      document.getElementById("sp_rekening").textContent = appState.providerInfo.rekening;
      document.getElementById("sp_bank").textContent = appState.providerInfo.bank;
      document.getElementById("sp_npwp").textContent = appState.providerInfo.npwp;
      document.getElementById("sp_tanggal").textContent = appState.providerInfo.tgl_sp;
      document.getElementById("sp_tahun").textContent = appState.generalInfo.tahun || "2025";
      document.getElementById("sp_kode_rek").textContent = appState.generalInfo.kode_rek || "";
      document.querySelector("#spTable .jumlah-total").textContent = formatNumber(total);
      
      // Update Nama & NIP di SP
      document.getElementById("pa_name").textContent = appState.generalInfo.pa || "M. AKIF, SH.";
      document.getElementById("pa_nip").textContent = appState.generalInfo.nip_pa || "19720103 200701 1 028";
      document.getElementById("pptk_name").textContent = appState.generalInfo.pptk || "JULIUS, SH";
      document.getElementById("pptk_nip").textContent = appState.generalInfo.nip_pptk || "19840714 201001 1 002";

      // Update Bukti Penerimaan (ST)
      updateTable("stTable", appState.items);
      document.getElementById("stTerbilang").textContent = terbilangText;
      document.getElementById("st_no").textContent = appState.providerInfo.no_bast;
      document.getElementById("st_tanggal").textContent = appState.providerInfo.tgl_bast;
      document.getElementById("st_perusahaan").textContent = appState.providerInfo.perusahaan;
      document.querySelector("#stTable .jumlah-total").textContent = formatNumber(total);
      document.getElementById("st_penyimpan").textContent = appState.generalInfo.penyimpan || "";
      document.getElementById("st_nip_penyimpan").textContent = appState.generalInfo.nip_penyimpan || "";
      document.getElementById("st_pptk").textContent = appState.generalInfo.pptk || "";
      document.getElementById("st_nip_pptk").textContent = appState.generalInfo.nip_pptk || "";

      // Update Kwitansi
      updateTable("kwitansiTable", appState.items);
      document.getElementById("kwitansiTerbilang").textContent = terbilangText;
      document.getElementById("kw_sp").textContent = appState.providerInfo.no_sp;
      document.getElementById("kw_sp_tgl").textContent = appState.providerInfo.tgl_sp;
      document.getElementById("kw_bast").textContent = appState.providerInfo.no_bast;
      document.getElementById("kw_bast_tgl").textContent = appState.providerInfo.tgl_bast;
      document.getElementById("kw_tanggal").textContent = appState.providerInfo.tgl_kwitansi;
      document.getElementById("kwitansi_sub_keg").textContent = appState.generalInfo.sub_keg || "";
      document.getElementById("kwitansi_belanja").textContent = appState.generalInfo.belanja || "";
      document.getElementById("kwitansi_tahun").textContent = appState.generalInfo.tahun || "";
      document.querySelector("#kwitansiTable .jumlah-total").textContent = formatNumber(total);
      document.getElementById("kw_no").textContent = appState.providerInfo.no_kwitansi;
      document.getElementById("kw_pimpinan").textContent = appState.providerInfo.pimpinan || "";
      document.getElementById("kw_perusahaan").textContent = appState.providerInfo.perusahaan || "";
      document.getElementById("kw_bp").textContent = appState.generalInfo.bp || "";
      document.getElementById("kw_nip_bp").textContent = appState.generalInfo.nip_bp || "";

      // Update total di tab input
      document.querySelector("#inputTable .jumlah-total").textContent = formatNumber(total);
      document.getElementById("terbilang").textContent = terbilangText;
    }

    // Fungsi untuk mengupdate tabel
    function updateTable(tableId, data) {
      const table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
      table.innerHTML = "";
      
      data.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="text-center">${item.no}</td>
          <td>${item.jenis}</td>
          <td>${item.keterangan}</td>
          <td class="number">${item.volume}</td>
          <td>${item.satuan}</td>
          <td class="number">${formatNumber(item.harga)}</td>
          <td class="number">${formatNumber(item.jumlah)}</td>
        `;
        table.appendChild(tr);
      });
    }

    // Fungsi format angka dengan separator ribuan
    function formatNumber(num) {
      return new Intl.NumberFormat('id-ID').format(num);
    }

    // Fungsi terbilang (versi lengkap)
    function terbilang(angka) {
      const bilangan = [
        '', 'Satu', 'Dua', 'Tiga', 'Empat', 'Lima', 'Enam', 'Tujuh', 'Delapan', 'Sembilan', 'Sepuluh', 'Sebelas'
      ];
      
      if (angka < 12) {
        return bilangan[angka];
      } else if (angka < 20) {
        return bilangan[angka-10] + ' Belas';
      } else if (angka < 100) {
        return bilangan[Math.floor(angka/10)] + ' Puluh ' + terbilang(angka%10);
      } else if (angka < 200) {
        return 'Seratus ' + terbilang(angka-100);
      } else if (angka < 1000) {
        return bilangan[Math.floor(angka/100)] + ' Ratus ' + terbilang(angka%100);
      } else if (angka < 2000) {
        return 'Seribu ' + terbilang(angka-1000);
      } else if (angka < 1000000) {
        return terbilang(Math.floor(angka/1000)) + ' Ribu ' + terbilang(angka%1000);
      } else if (angka < 1000000000) {
        return terbilang(Math.floor(angka/1000000)) + ' Juta ' + terbilang(angka%1000000);
      } else if (angka < 1000000000000) {
        return terbilang(Math.floor(angka/1000000000)) + ' Milyar ' + terbilang(angka%1000000000);
      } else {
        return 'Angka terlalu besar';
      }
    }

    // Fungsi tambah baris
    function addRow() {
      const table = document.getElementById("inputTable").getElementsByTagName('tbody')[0];
      const rowCount = table.rows.length + 1;
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td class="number">${rowCount}</td>
        <td>
          <select onchange="updateRow(this)" class="jenis-barang">
            <option value="Foto Copy">Foto Copy</option>
            <option value="ATK">ATK</option>
            <option value="Lainnya">Lainnya</option>
          </select>
        </td>
        <td>
          <textarea placeholder="Masukkan keterangan..." oninput="updateRow(this)" rows="2" class="keterangan"></textarea>
        </td>
        <td>
          <input type="number" class="volume" oninput="calculateRow(this)" min="0" step="0.01" value="0">
        </td>
        <td>
          <select class="satuan" onchange="updateRow(this)">
            <option value="Lembar">Lembar</option>
            <option value="Buku">Buku</option>
            <option value="Rim">Rim</option>
            <option value="Pcs">Pcs</option>
            <option value="Unit">Unit</option>
          </select>
        </td>
        <td>
          <input type="number" class="harga" oninput="calculateRow(this)" min="0" step="100" value="0">
        </td>
        <td class="jumlah number bold">0</td>
      `;
      table.appendChild(tr);
      saveInputData();
      updateOutputTabs();
    }

    // Fungsi hapus baris
    function removeRow() {
      const table = document.getElementById("inputTable").getElementsByTagName('tbody')[0];
      if (table.rows.length > 1) {
        table.deleteRow(-1);
        
        // Perbarui nomor urut
        const rows = table.querySelectorAll("tr");
        rows.forEach((row, index) => {
          row.querySelector("td:first-child").textContent = index + 1;
        });
        
        saveInputData();
        updateOutputTabs();
      }
    }

    // Fungsi hitung per baris
    function calculateRow(input) {
      const row = input.closest("tr");
      const volume = parseFloat(row.querySelector(".volume").value) || 0;
      const harga = parseFloat(row.querySelector(".harga").value) || 0;
      const jumlah = volume * harga;
      row.querySelector(".jumlah").textContent = formatNumber(jumlah);
      saveInputData();
      updateOutputTabs();
    }

    // Fungsi update row
    function updateRow(input) {
      saveInputData();
      updateOutputTabs();
    }

    // Fungsi validasi input
    function validateInputs() {
      const requiredFields = [
        'tahun', 'unit', 'pa', 'nip_pa', 'jabatan_pa', 
        'pptk', 'nip_pptk', 'jabatan_pptk',
        'penyimpan', 'nip_penyimpan', 'jabatan_penyimpan',
        'bp', 'nip_bp', 'jabatan_bp',
        'alamat_kel', 'bidang', 'sub_keg', 'kode_rek', 'ro', 'belanja',
        'no_sp', 'tgl_sp', 'no_bast', 'tgl_bast',
        'perusahaan', 'pimpinan', 'alamat', 'rekening', 'bank', 'npwp',
        'no_kwitansi', 'tgl_kwitansi'
      ];
      
      let isValid = true;
      let emptyFields = [];
      
      requiredFields.forEach(id => {
        const element = document.getElementById(id);
        if (!element.value.trim()) {
          element.style.borderColor = 'red';
          isValid = false;
          emptyFields.push(id);
        } else {
          element.style.borderColor = '';
        }
      });
      
      // Validasi minimal satu item barang
      if (appState.items.length === 0 || appState.items.every(item => item.volume === 0 || item.harga === 0)) {
        showAlert('error', 'Harap tambahkan minimal satu item barang dengan volume dan harga yang valid');
        isValid = false;
      }
      
      if (!isValid && emptyFields.length > 0) {
        showAlert('error', `Harap isi semua field yang wajib diisi. Field kosong: ${emptyFields.join(', ')}`);
      }
      
      return isValid;
    }

    // Fungsi reset form
    function resetForm() {
      if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
        // Reset input fields
        document.querySelectorAll('#input input, #input select, #input textarea').forEach(element => {
          if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.value = '';
          } else if (element.tagName === 'SELECT') {
            element.selectedIndex = 0;
          }
        });
        
        // Reset tabel barang (kembali ke 1 baris kosong)
        const table = document.getElementById("inputTable").getElementsByTagName('tbody')[0];
        table.innerHTML = `
          <tr>
            <td class="number">1</td>
            <td>
              <select onchange="updateRow(this)" class="jenis-barang">
                <option value="Foto Copy">Foto Copy</option>
                <option value="ATK">ATK</option>
                <option value="Lainnya">Lainnya</option>
              </select>
            </td>
            <td>
              <textarea placeholder="Masukkan keterangan..." oninput="updateRow(this)" rows="2" class="keterangan"></textarea>
            </td>
            <td>
              <input type="number" class="volume" oninput="calculateRow(this)" min="0" step="0.01" value="0">
            </td>
            <td>
              <select class="satuan" onchange="updateRow(this)">
                <option value="Lembar">Lembar</option>
                <option value="Buku">Buku</option>
                <option value="Rim">Rim</option>
                <option value="Pcs">Pcs</option>
                <option value="Unit">Unit</option>
              </select>
            </td>
            <td>
              <input type="number" class="harga" oninput="calculateRow(this)" min="0" step="100" value="0">
            </td>
            <td class="jumlah number bold">0</td>
          </tr>
        `;
        
        // Reset state
        appState.generalInfo = {};
        appState.providerInfo = {};
        appState.items = [];
        
        // Update output tabs
        updateOutputTabs();
        
        showAlert('success', 'Form telah direset');
      }
    }

    // Fungsi simpan ke localStorage
    function saveToLocalStorage() {
      saveInputData();
      localStorage.setItem('spjData', JSON.stringify(appState));
      showAlert('success', 'Data berhasil disimpan sementara di browser');
    }

    // Fungsi load dari localStorage
    function loadFromLocalStorage() {
      const savedData = localStorage.getItem('spjData');
      if (savedData) {
        const parsedData = JSON.parse(savedData);
        
        // Isi form dengan data yang ada
        Object.keys(parsedData.generalInfo).forEach(key => {
          const element = document.getElementById(key);
          if (element) element.value = parsedData.generalInfo[key];
        });
        
        Object.keys(parsedData.providerInfo).forEach(key => {
          const element = document.getElementById(key);
          if (element) element.value = parsedData.providerInfo[key];
        });
        
        // Isi tabel barang
        const table = document.getElementById("inputTable").getElementsByTagName('tbody')[0];
        table.innerHTML = '';
        
        parsedData.items.forEach((item, index) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="number">${index + 1}</td>
            <td>
              <select onchange="updateRow(this)" class="jenis-barang">
                <option value="Foto Copy" ${item.jenis === 'Foto Copy' ? 'selected' : ''}>Foto Copy</option>
                <option value="ATK" ${item.jenis === 'ATK' ? 'selected' : ''}>ATK</option>
                <option value="Lainnya" ${item.jenis === 'Lainnya' ? 'selected' : ''}>Lainnya</option>
              </select>
            </td>
            <td>
              <textarea placeholder="Masukkan keterangan..." oninput="updateRow(this)" rows="2" class="keterangan">${item.keterangan}</textarea>
            </td>
            <td>
              <input type="number" class="volume" oninput="calculateRow(this)" min="0" step="0.01" value="${item.volume}">
            </td>
            <td>
              <select class="satuan" onchange="updateRow(this)">
                <option value="Lembar" ${item.satuan === 'Lembar' ? 'selected' : ''}>Lembar</option>
                <option value="Buku" ${item.satuan === 'Buku' ? 'selected' : ''}>Buku</option>
                <option value="Rim" ${item.satuan === 'Rim' ? 'selected' : ''}>Rim</option>
                <option value="Pcs" ${item.satuan === 'Pcs' ? 'selected' : ''}>Pcs</option>
                <option value="Unit" ${item.satuan === 'Unit' ? 'selected' : ''}>Unit</option>
              </select>
            </td>
            <td>
              <input type="number" class="harga" oninput="calculateRow(this)" min="0" step="100" value="${item.harga}">
            </td>
            <td class="jumlah number bold">${formatNumber(item.jumlah)}</td>
          `;
          table.appendChild(tr);
        });
        
        // Update state dan output
        appState.generalInfo = parsedData.generalInfo;
        appState.providerInfo = parsedData.providerInfo;
        appState.items = parsedData.items;
        
        updateOutputTabs();
        showAlert('success', 'Data berhasil dimuat dari penyimpanan sementara');
      } else {
        showAlert('error', 'Tidak ada data tersimpan di browser');
      }
    }

    // Fungsi cetak SP
    function printSP() {
      const printContent = document.getElementById("printAreaSP").innerHTML;
      const originalContent = document.body.innerHTML;

      document.body.innerHTML = `
        <div style="font-family: 'Arial Narrow', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
          ${printContent}
        </div>
      `;

      window.print();

      document.body.innerHTML = originalContent;
      updateOutputTabs();
    }

    // Fungsi cetak ST
    function printST() {
      const printContent = document.getElementById("printAreaST").innerHTML;
      const originalContent = document.body.innerHTML;

      document.body.innerHTML = `
        <div style="font-family: 'Arial Narrow', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
          ${printContent}
        </div>
      `;

      window.print();

      document.body.innerHTML = originalContent;
      updateOutputTabs();
    }

    // Fungsi cetak Kwitansi
    function printKwitansi() {
      const printContent = document.getElementById("printAreaKwitansi").innerHTML;
      const originalContent = document.body.innerHTML;

      document.body.innerHTML = `
        <div style="font-family: 'Arial Narrow', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
          ${printContent}
        </div>
      `;

      window.print();

      document.body.innerHTML = originalContent;
      updateOutputTabs();
    }

    // Fungsi export ke PDF (mockup)
    function exportToPDF(elementId, fileName) {
      showAlert('info', 'Fitur export PDF akan segera tersedia');
      // Implementasi nyata membutuhkan library seperti jsPDF
      // window.jsPDF = window.jspdf.jsPDF;
      // const doc = new jsPDF();
      // doc.html(document.getElementById(elementId), {
      //   callback: function(doc) {
      //     doc.save(fileName + '.pdf');
      //   }
      // });
    }

    // Fungsi simpan ke Firebase
    async function saveToFirebase() {
      if (!validateInputs()) {
        return;
      }

      saveInputData();
      
      try {
        showAlert('info', 'Menyimpan data ke server...');
        
        const dataToSave = {
          ...appState.generalInfo,
          ...appState.providerInfo,
          items: appState.items,
          total: appState.items.reduce((sum, item) => sum + item.jumlah, 0),
          terbilang: terbilang(appState.items.reduce((sum, item) => sum + item.jumlah, 0)) + " Rupiah",
          createdAt: new Date().toISOString()
        };
        
        const docId = await firebaseService.saveData(dataToSave);
        showAlert('success', `Data berhasil disimpan dengan ID: ${docId}`);
        
        // Simpan juga ke localStorage
        saveToLocalStorage();
      } catch (error) {
        console.error("Gagal menyimpan ke Firebase:", error);
        showAlert('error', `Gagal menyimpan data: ${error.message}`);
      }
    }

    // Fungsi show alert
    function showAlert(type, message) {
      const alertArea = document.getElementById("alertArea");
      const alert = document.createElement("div");
      alert.className = `alert alert-${type}`;
      alert.innerHTML = message;
      
      alertArea.appendChild(alert);
      
      // Hapus alert setelah 5 detik
      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    // Fungsi set default tanggal
    function setDefaultDates() {
      const today = new Date();
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      const formattedDate = today.toLocaleDateString('id-ID', options);
      
      if (!document.getElementById('tgl_sp').value) {
        document.getElementById('tgl_sp').value = formattedDate;
      }
      
      if (!document.getElementById('tgl_bast').value) {
        document.getElementById('tgl_bast').value = formattedDate;
      }
      
      if (!document.getElementById('tgl_kwitansi').value) {
        document.getElementById('tgl_kwitansi').value = `Pontianak, ${formattedDate}`;
      }
    }

    // Inisialisasi saat halaman dimuat
    document.addEventListener('DOMContentLoaded', function() {
      // Set default tanggal
      setDefaultDates();
      
      // Load data dari localStorage jika ada
      loadFromLocalStorage();
      
      // Tambahkan event listener untuk tab
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const tabName = this.getAttribute('data-tab');
          openTab(tabName);
        });
      });
      
      // Tambahkan event listener untuk auto-save
      document.querySelectorAll('#input input, #input select, #input textarea').forEach(element => {
        element.addEventListener('change', () => {
          saveInputData();
          updateOutputTabs();
        });
      });
    });
  </script>
</body>
</html>